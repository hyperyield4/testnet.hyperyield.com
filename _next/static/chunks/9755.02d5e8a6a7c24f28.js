"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9755],{63728:function(e,a,n){n.d(a,{a:function(){return l}});var t=n(18763),s=n(67294),l=()=>{let{authCoreModal:e}=(0,t.qa)(),a=(0,s.useMemo)(()=>e.rootModalContainer,[e]),n=(0,s.useCallback)((e,n="")=>{var t;let s=document.createElement("div");s.className="ant-message-notice";let l=document.createElement("div");l.className="ant-message-notice-content";let i=document.createElement("div");i.className="ant-message-custom-content";let r=document.createElement("span");r.setAttribute("role","img"),r.setAttribute("aria-label","check-circle"),r.className="anticon anticon-check-circle";let c=document.createElement("svg");"success"===e?(i.className+=" ant-message-success",c.innerHTML='<svg viewBox="64 64 896 896" focusable="false" data-icon="check-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"></path></svg>'):"error"===e?(i.className+=" ant-message-error",c.innerHTML='<svg viewBox="64 64 896 896" focusable="false" data-icon="close-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z"></path></svg>'):"info"===e?(i.className+=" ant-message-info",c.innerHTML='<svg viewBox="64 64 896 896" focusable="false" data-icon="info-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"></path></svg>'):"warning"===e&&(i.className+=" ant-message-warning",c.innerHTML='<svg viewBox="64 64 896 896" focusable="false" data-icon="exclamation-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"></path></svg>');let o=document.createElement("span");return o.textContent=n,r.appendChild(c),i.appendChild(r),i.appendChild(o),l.appendChild(i),s.appendChild(l),null==(t=null==a?void 0:a.querySelector(".ant-message"))||t.appendChild(s),s},[a]),l=(0,s.useCallback)(e=>{let t=n("error",e);setTimeout(()=>{var e;null==(e=null==a?void 0:a.querySelector(".ant-message"))||e.removeChild(t)},2e3)},[n]),i=(0,s.useCallback)(e=>{let t=n("info",e);setTimeout(()=>{var e;null==(e=null==a?void 0:a.querySelector(".ant-message"))||e.removeChild(t)},2e3)},[n]),r=(0,s.useCallback)(e=>{let t=n("success",e);setTimeout(()=>{var e;null==(e=null==a?void 0:a.querySelector(".ant-message"))||e.removeChild(t)},2e3)},[n]),c=(0,s.useCallback)(e=>{let t=n("warning",e);setTimeout(()=>{var e;null==(e=null==a?void 0:a.querySelector(".ant-message"))||e.removeChild(t)},2e3)},[n]);return(0,s.useEffect)(()=>{if(a){if(a.querySelector(".ant-message"))return;let e=document.createElement("div");e.className="ant-message",a.appendChild(e)}},[a]),{error:l,info:i,success:r,warning:c}}},9755:function(e,a,n){n.r(a),n.d(a,{default:function(){return E}});var t=n(42700),s=n(19279),l=n(63728),i=n(81163),r=n(18763),c=n(76099),o=n(68376),m=n(54117),d=n(75325),u=n(56469),g=n(77191),v=n(67294),h=n(80594),p=n(42763),f={async findAssociatedTokenAddress(e,a){let{TOKEN_PROGRAM_ID:t}=await Promise.all([n.e(8766),n.e(4625),n.e(1107)]).then(n.bind(n,91107)),{PublicKey:s}=await Promise.all([n.e(8766),n.e(4625)]).then(n.bind(n,59917));return s.findProgramAddressSync([new s(e).toBuffer(),t.toBuffer(),new s(a).toBuffer()],new s("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))[0]}},E=function(e){var a;let n,{method:E,param:C,chainId:N,loginAuthorizationSign:y}=e,{t:w}=(0,p.$G)(),S=(0,r.sa)(),{setPaymentVerify:_,userInfo:T,setPaymentPassword:k}=(0,r.ta)(),{events:A}=(0,r.va)(),{modalOptions:I}=(0,r.ua)(),{authCoreModal:b}=(0,r.qa)(),{errorHandle:M}=(0,s.a)(),[R,P]=(0,v.useState)(!1),U=(0,l.a)(),[L,q]=(0,v.useState)(),[z,x]=(0,v.useState)(),[B,O]=(0,v.useState)(),[G,K]=(0,v.useState)(""),[H,V]=(0,v.useState)(""),{hasSetPaymentPassword:F,showSetPaymentPasswordOrConfirm:$}=(0,t.b)(),D=(0,v.useMemo)(()=>({id:N||o.EU.solana.chainId,name:"Solana"}),[]),Z=(0,v.useMemo)(()=>{let e=o.EU.solana.selectedAddress;return(0,r.P)(e)},[]);(0,v.useEffect)(()=>{(0,o.pq)().catch(e=>{}),(0,o.GD)()&&S("account/master-password/verify")},[S]);let W=()=>{(0,o.pq)().then(()=>{j()}).catch(e=>{var a;P(!1),U.error(null!=(a=e.message)?a:"Sign Error")})},X=(e,a)=>{A.emit("signResponse",{result:e,error:a})};async function J(e,a){if(!a)return[];let n=await Promise.all(a.map(e));return a.filter((e,a)=>n[a])}let j=async()=>{var e,a;E&&((0,o.KH)({record_type:c.oX.PAGE_SIGN_CONFIRM_BUTTON_CLICK}),null!=(e=null==T?void 0:T.security_account)&&e.has_set_payment_password?_({visible:!0,onVerifyCompleted:Q}):E===o.RI.signAndSendTransaction||E===o.RI.signTransaction||E===o.RI.signAllTransactions||(null==(a=null==I?void 0:I.promptSettingConfig)?void 0:a.promptPaymentPasswordSettingWhenSign)===3?$(Q):Q())},Q=async()=>{var e;let a;if(E){P(!0);try{if(E===o.RI.signMessage)a=await o.EU.solana.signMessage(C);else if(E===o.RI.signAndSendTransaction)a=await o.EU.solana.signAndSendTransaction(C,D.id);else if(E===o.RI.signTransaction)a=await o.EU.solana.signTransaction(C,D.id);else if(E===o.RI.signAllTransactions)a=await o.EU.solana.signAllTransactions(C,D.id);else throw Error("Unknown method");(0,o.KH)({record_type:c.oX.PAGE_SIGN_CONFIRM_BUTTON_CLICK_SUCCESS})}catch(a){(0,o.KH)({record_type:c.oX.PAGE_SIGN_CONFIRM_BUTTON_CLICK_FAILURE}),(null==a?void 0:a.error_code)!==50103||null!=(e=null==T?void 0:T.security_account)&&e.has_set_payment_password?(null==a?void 0:a.message)==="Local Key not found"||(null==a?void 0:a.message)==="Master password decryption error"?S("account/master-password/verify"):M(a):W()}finally{P(!1)}a&&(E===o.RI.signMessage&&y?A.emit("loginSuccess",{...T,authorization:{message:g.encode(C),signature:a}}):X(a))}};(0,v.useEffect)(()=>{if(E===o.RI.signMessage)K(w("sign.signature_message")),V(w("sign.signature_title"));else if(E===o.RI.signAndSendTransaction){K(w("sign.send_transaction")),V(w("sign.approve_and").format((0,r.I)(D)));let e=C.serialize({requireAllSignatures:!1,verifySignatures:!1});Y([g.encode(e)])}else if(E===o.RI.signTransaction){K(w("sign.sign_transaction")),V(w("sign.sign_but"));let e=C.serialize({requireAllSignatures:!1,verifySignatures:!1});Y([g.encode(e)])}else if(E===o.RI.signAllTransactions)K(w("sign.sign_transaction")),V(w("sign.sign_but")),Y(C.map(e=>g.encode(e.serialize({requireAllSignatures:!1,verifySignatures:!1}))));else throw Error("Unknown method")},[C]),(0,v.useEffect)(()=>{o.EU.solana.connect()},[]);let Y=e=>{o.EU.solana.request({chainId:D.id,method:o.SJ.enhancedDeserializeTransaction,params:e}).then(e=>{var a,n;q(e),J(async e=>{let a=await f.findAssociatedTokenAddress(o.EU.solana.selectedAddress,e.mint);return e.associatedTokenAddress===a.toBase58()},null==(a=null==e?void 0:e.estimatedChanges)?void 0:a.nfts).then(e=>{x(e)}),J(async e=>{let a=await f.findAssociatedTokenAddress(o.EU.solana.selectedAddress,e.mint);return e.associatedTokenAddress===a.toBase58()},null==(n=null==e?void 0:e.estimatedChanges)?void 0:n.tokens).then(e=>{O(e)})}).catch(a=>{var n;m.Z.error({title:null!=(n=a.message)?n:"Deserialize Transaction Error",okCancel:!0,cancelText:w("common.cancel"),okText:w("common.retry"),wrapClassName:"auth-core-modal-error",getContainer:()=>b.rootBody,onOk:()=>{Y(e)}})})};return v.createElement("div",{className:"info-sign"},v.createElement("style",null,t.c),!F&&v.createElement("div",{className:"has-payment-password","data-telegram":(0,r.na)()},v.createElement("div",{className:"has-payment-password-icon"}),v.createElement("div",{className:"has-payment-password-tip"},w("account.waring_tip1")),v.createElement("div",{className:"has-payment-password-set",onClick:k},w("account.set"))),v.createElement("div",{className:"scroll-part"+(F?"":" no-password-tip")},v.createElement(t.d,{userInfo:T,transactionInfo:L}),v.createElement("div",{className:"info-request"},G),v.createElement("div",{className:"info-title"},v.createElement("img",{src:(0,r.K)(D),alt:""}),(0,r.I)(D)),v.createElement(h,{text:o.EU.solana.selectedAddress,onCopy:()=>U.success(w("new.copied_to"))},v.createElement("div",{className:"info-address"},Z,v.createElement("div",{className:"copy-icon"},v.createElement(t.a,null)))),v.createElement("div",{className:"info-des"},H),v.createElement("div",{className:"apart-line"}),E===o.RI.signMessage&&(n=new TextDecoder().decode(C),v.createElement("div",{className:"sign-message"},v.createElement("div",{className:"message"+(F?"":" no-password-tip")},v.createElement("div",{className:"pre-wrap personal-message"},n)))),E!==o.RI.signMessage&&v.createElement(d.default,{defaultActiveKey:"1",items:[{label:w("sign.details"),key:"1",children:v.createElement(v.Fragment,null,v.createElement("div",{className:"balance-change"},v.createElement("div",{className:"title"},w("sign.estimated_balance_change")),v.createElement("div",{className:"change-body"},null==(a=null==L?void 0:L.estimatedChanges)?void 0:a.sols.filter(e=>{var a,n;return e.address===(null==(n=null==(a=o.EU)?void 0:a.solana)?void 0:n.selectedAddress)}).map((e,a)=>v.createElement("div",{className:"change-title",key:`sol-change-${a}`},"SOL",v.createElement("div",{className:"change-val",style:e.lamportsChange<0?{color:"#ea4335"}:{}},e.lamportsChange<0?"":"+",(0,r.V)(e.lamportsChange,9)))),null==z?void 0:z.map((e,a)=>v.createElement("div",{className:"change-title",key:`nft-change-${a}`},e.name?e.name:"Unknown NFT",v.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",e.amountChange))),null==B?void 0:B.map((e,a)=>v.createElement("div",{className:"change-title",key:`token-change-${a}`},e.name?e.name:"Unknown Token",v.createElement("div",{className:"change-val",style:e.amountChange<0?{color:"#ea4335"}:{}},e.amountChange<0?"":"+",(0,r.V)(e.amountChange,e.decimals)))))),v.createElement("div",{className:"net-fee solana"},v.createElement("div",{className:"title"},w("sign.network_fee"),L&&v.createElement("div",{className:"fee-val"},(0,r.V)(L.estimatedLamportsFee,9)," SOL"))))},{label:w("sign.data"),key:"2",children:v.createElement("div",null,null==L?void 0:L.instructions.map((e,a)=>v.createElement("div",{className:"inner-instruction",key:`instruction-${a}`},v.createElement("div",{className:"inner-content"},v.createElement("div",{className:"content-item"},v.createElement("div",{className:"item"},v.createElement("div",{className:"item-0"},"#",a+1," - ",w(`program.${e.type}`)),v.createElement("div",{className:"item-1 mt10"},w("sign.program_id"),v.createElement("span",null,(0,r.P)(e.programId))),v.createElement("div",{className:"item-1 mt15"},w("sign.data"),v.createElement("span",null,(0,r.P)(e.data)))))))))}]})),v.createElement("div",{className:"btn-box"},v.createElement("div",null,v.createElement(u.Z,{className:"btn-cancel",onClick:()=>{R||(y?A.emit("loginSuccess",T):X(void 0,r.a.userRejectedRequest()))}},w("common.cancel")),v.createElement(u.Z,{className:"btn-approve",onClick:j,loading:R},w("common.confirm"))),v.createElement(i.a,null)))}}}]);